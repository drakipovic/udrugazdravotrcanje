{% extends 'base.html' %}


{% block content %}

<div class="content-wrapper">
        <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            {{league.name}} {{league.year}}
            <small>Created by {{league.created_by.username}}</small>
            
        </h1>
        <ol class="breadcrumb">
            <li><a href="/"><i class="fa fa-dashboard"></i> Home</a></li>
            <li><a href="/admin/leagues"><i class="fa fa-trophy"></i> Leagues</a></li>
            <li class="active">League</li>
        </ol>
    </section>

    <section class="content">
        <div class="row">
            <div class="col-sm-12">
                <div class="box box-danger">
                        <div class="box-header">
                            <h3 class="box-title">Races</h3>
                        </div>
                        <div class="box-body no-padding">
                            <table id="leaguesTable" class="table table-bordered">
                                <tr>
                                    <th>Round</th>
                                    <th>Participants</th>
                                    <th>Start time</th>
                                    <th>Finished</th>
                                    <th>Actions</th>
                                </tr>
                                {% for race in league.races %}
                                    {% set race = dict(race) %}
                                    <tr>
                                        <td><a href="/admin/races/{{race.id}}">Race {{race.round + 1}}</a></td>
                                        <td>-</td>
                                        <td>
                                            {% if race.start_time == False %}
                                                <div id="datetimeForm{{race.id}}" class="form-group">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-addon">
                                                            <i class="fa fa-calendar"></i>
                                                        </div>
                                                        <input type="text" id="inputDatetime{{race.id}}" class="form-control" data-inputmask="'alias': 'dd/mm/yyyy hh:mm'" data-mask>
                                                        <span class="input-group-btn">
                                                            <button onclick="editStartTime({{race.id}})" type="button" class="btn btn-success btn-flat"><span class="glyphicon glyphicon-ok"/></button>
                                                        </span>
                                                    </div>
                                                </div>
                                            {% else %}
                                                {{ race.start_time }}
                                            {% endif %}
                                            <div id="editedDateTime{{race.id}}" hidden></div>
                                        </td>
                                        {% if race.finished %}
                                            <td><span class="badge bg-green"><i class="fa fa-check"/></span></td>
                                        {% else %}
                                            <td><span class="badge bg-red"><i class="fa fa-times"/></span></td>
                                        {% endif %}
                                        <td>
                                            <span class="text-info glyphicon glyphicon-edit"/>&nbsp;
                                            <span class="text-danger glyphicon glyphicon-trash"/>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
            </div>
        </div>

    </section>

</div>


{% endblock %}

{% block page_js %}
<script>
    function editStartTime(race_id){
        if($("#inputDatetime"+race_id).val()){
            var data = {"start_time": $("#inputDatetime"+race_id).val()};
            console.log(data);
            $.ajax({
                url: '/api/races/' + race_id,
                method: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function(data){
                    console.log(data);
                    $("#datetimeForm"+data['race']['id']).hide();
                    $("#editedDateTime"+data['race']['id']).show();
                    $("#editedDateTime"+data['race']['id']).html(data['race']['start_time']);
                }
            });
        }
    }
</script>

<script>

    $("[id^='inputDatetime']").inputmask({
        mask: "1-2-y h:s",
        alias: "dd-mm-yyyy",
        placeholder: "dd-mm-yyyy hh:mm",
        separator: '-'
    });
</script>


{% endblock %}